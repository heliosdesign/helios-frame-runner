define([],function(){"use strict";function extend(){for(var output={},args=arguments,l=args.length,i=0;l>i;i++)for(var key in args[i])args[i].hasOwnProperty(key)&&(output[key]=args[i][key]);return output}!function(){for(var lastTime=0,vendors=["ms","moz","webkit","o"],x=0;x<vendors.length&&!window.requestAnimationFrame;++x)window.requestAnimationFrame=window[vendors[x]+"RequestAnimationFrame"],window.cancelAnimationFrame=window[vendors[x]+"CancelAnimationFrame"]||window[vendors[x]+"CancelRequestAnimationFrame"];window.requestAnimationFrame||(window.requestAnimationFrame=function(callback){var currTime=(new Date).getTime(),timeToCall=Math.max(0,16-(currTime-lastTime)),id=window.setTimeout(function(){callback(currTime+timeToCall)},timeToCall);return lastTime=currTime+timeToCall,id}),window.cancelAnimationFrame||(window.cancelAnimationFrame=function(id){clearTimeout(id)})}();var rafID,debug=!0,log=function(msg){debug&&console.log(msg)},error=function(msg){if(debug)throw new Error(msg)},running=!1,startRafLoop=function(){running||(running=!0,rafID=window.requestAnimationFrame(rafFunction),log("[frameRunner] start RAF Loop"))},stopRafLoop=function(){running&&(running=!1,window.cancelAnimationFrame(rafID),log("[frameRunner] stop RAF Loop"))},functions={everyFrame:{},everySecond:{}},functionCount={everyFrame:0,everySecond:0},addFunction=function(opts){var defaults={id:void 0,f:void 0,type:"everyFrame",autostart:!0},options=extend(defaults,opts);return options.id&&options.f?"function"!=typeof options.f?void error('"'+options.id+'" is not a valid function'):functions[options.type][options.id]?void error("[frameRunner] function exists"):(log('[frameRunner] adding "'+options.id+'" to '+options.type),functions[options.type][options.id]=options.f,functionCount[options.type]+=1,options.autostart&&startRafLoop(),function(){removeFunction(options.id,options.type)}):void error('can’t add "'+options.id+'"; missing argument')},removeFunction=function(opts){var defaults={id:void 0,type:"everyFrame",autostop:!0},options=extend(defaults,opts);functions[options.type][options.id]?(log('[frameRunner] removing "'+options.id+'" from '+options.type),delete functions[options.type][options.id],functionCount[options.type]-=1,!options.autostop||functionCount.everyFrame||functionCount.everySecond||stopRafLoop()):error('function "'+name+'" doesn’t exist')},check=function(opts){var defaults={id:void 0,type:"everyFrame"},options=extend(defaults,opts);return!!functions[options.type][options.id]},getFrameCount=function(){return rafID},isRunning=function(){return running},counter=0,rafFunction=function(){rafID=requestAnimationFrame(rafFunction),counter++,counter>60&&(counter=0);for(var func in functions.everyFrame)functions.everyFrame.hasOwnProperty(func)&&functions.everyFrame[func]();if(0===counter)for(var func in functions.everySecond)functions.everySecond.hasOwnProperty(func)&&functions.everySecond[func]()};return{start:startRafLoop,stop:stopRafLoop,add:addFunction,remove:removeFunction,check:check,running:isRunning,frameCount:getFrameCount,debug:debug}});