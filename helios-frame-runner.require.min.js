define([],function(){"use strict";function extend(){for(var output={},args=arguments,l=args.length,i=0;l>i;i++)for(var key in args[i])args[i].hasOwnProperty(key)&&(output[key]=args[i][key]);return output}function log(msg){debug&&console.log(msg)}function error(msg){if(debug)throw new Error(msg)}function startRafLoop(){running||(running=!0,rafID=window.requestAnimationFrame(rafFunction),log("[frameRunner] start RAF Loop"))}function stopRafLoop(){running&&(running=!1,window.cancelAnimationFrame(rafID),log("[frameRunner] stop RAF Loop"))}function addFunction(opts){var defaults={id:void 0,f:void 0,type:"everyFrame",autostart:!0},options=extend(defaults,opts);return options.id&&options.f?"function"!=typeof options.f?void error('"'+options.id+'" is not a valid function'):functionLookup[options.type][options.id]?void error("[frameRunner] function exists"):(log('[frameRunner] adding "'+options.id+'" to '+options.type),functionLookup[options.type][options.id]=options.f,functionArray[options.type].push(options.f),options.autostart&&startRafLoop(),function(){removeFunction(options.id,options.type)}):void error('can’t add "'+options.id+'"; missing argument')}function removeFunction(opts){var defaults={id:void 0,type:"everyFrame",autostop:!0},options=extend(defaults,opts),theFunction=functionLookup[options.type][options.id];if(theFunction){log('[frameRunner] removing "'+options.id+'" from '+options.type);for(var i=functionArray[options.type].length-1;i>=0;i--)functionArray[options.type][i]===theFunction&&functionArray[options.type].splice(i,1);delete functionLookup[options.type][options.id],!options.autostop||functionArray.everyFrame.length||functionArray.everySecond.length||stopRafLoop()}else error('function "'+name+'" doesn’t exist')}function removeAll(){functionLookup={everyFrame:{},everySecond:{}},functionArray={everyFrame:[],everySecond:[]}}function check(opts){var defaults={id:void 0,type:"everyFrame"},options=extend(defaults,opts);return!!functionLookup[options.type][options.id]}function getFrameCount(){return rafID}function isRunning(){return running}function rafFunction(){rafID=requestAnimationFrame(rafFunction),counter++,counter>60&&(counter=0);for(var i=functionArray.everyFrame.length-1;i>=0;i--)functionArray.everyFrame[i]();if(0===counter)for(var i=functionArray.everySecond.length-1;i>=0;i--)functionArray.everySecond[i]()}function polyfill(){for(var lastTime=0,vendors=["ms","moz","webkit","o"],x=0;x<vendors.length&&!window.requestAnimationFrame;++x)window.requestAnimationFrame=window[vendors[x]+"RequestAnimationFrame"],window.cancelAnimationFrame=window[vendors[x]+"CancelAnimationFrame"]||window[vendors[x]+"CancelRequestAnimationFrame"];window.requestAnimationFrame||(window.requestAnimationFrame=function(callback){var currTime=(new Date).getTime(),timeToCall=Math.max(0,16-(currTime-lastTime)),id=window.setTimeout(function(){callback(currTime+timeToCall)},timeToCall);return lastTime=currTime+timeToCall,id}),window.cancelAnimationFrame||(window.cancelAnimationFrame=function(id){clearTimeout(id)})}var rafID,counter=0,debug=!1,running=!1,functionLookup={everyFrame:{},everySecond:{}},functionArray={everyFrame:[],everySecond:[]};return polyfill(),{start:startRafLoop,stop:stopRafLoop,add:addFunction,remove:removeFunction,removeAll:removeAll,check:check,running:isRunning,frameCount:getFrameCount,debug:debug}});